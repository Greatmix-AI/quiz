<body>
    <h1>Opmed.ai Knowledge Quiz</h1>
    <div id="progress"></div>
    <div id="quiz"></div>
    <button onclick="submitQuiz()">Submit Quiz</button>
    <div id="results"></div>

    <script>
        let quizData = [];

        function loadCSV() {
            fetch('questions.csv')
                .then(response => response.text())
                .then(data => {
                    quizData = csvToJson(data);
                    shuffleArray(quizData);  // Shuffle questions
                    createQuiz();
                })
                .catch(error => {
                    console.error('Error loading CSV:', error);
                    document.getElementById('quiz').innerHTML = 'Error loading quiz. Please try again later.';
                });
        }

        function createQuiz() {
            const quizContainer = document.getElementById('quiz');
            quizData.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                
                // Create an array of all options and shuffle it
                let options = [
                    {text: question['Option 1'], correct: true},
                    {text: question['Option 2'], correct: false},
                    {text: question['Option 3'], correct: false},
                    {text: question['Option 4'], correct: false}
                ];
                shuffleArray(options);

                questionDiv.innerHTML = `
                    <p><strong>Question ${index + 1}:</strong> ${question.Question}</p>
                    <div class="options">
                        ${options.map((option, i) => `
                            <label class="option">
                                <input type="radio" name="q${index}" value="${i}" data-correct="${option.correct}">
                                ${option.text}
                            </label>
                        `).join('')}
                    </div>
                `;
                quizContainer.appendChild(questionDiv);
            });
            updateProgress();
        }

        function submitQuiz() {
            const results = [];
            quizData.forEach((_, index) => {
                const selected = document.querySelector(`input[name="q${index}"]:checked`);
                if (selected) {
                    results.push(selected.dataset.correct === 'true');
                    selected.parentElement.classList.add(selected.dataset.correct === 'true' ? 'correct' : 'incorrect');
                } else {
                    results.push(null);
                }
            });
            displayResults(results);
        }

        function displayResults(results) {
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = '<h2>Quiz Results</h2>';
            let score = 0;
            results.forEach((result, index) => {
                if (result === true) {
                    score++;
                    resultsContainer.innerHTML += `<p>Question ${index + 1}: Correct</p>`;
                } else if (result === null) {
                    resultsContainer.innerHTML += `<p>Question ${index + 1}: Not answered</p>`;
                } else {
                    resultsContainer.innerHTML += `<p>Question ${index + 1}: Incorrect</p>`;
                }
            });
            resultsContainer.innerHTML += `<h3>Total Score: ${score}/${results.length}</h3>`;
        }

        function updateProgress() {
            const progress = document.getElementById('progress');
            progress.innerHTML = `Question 1 of ${quizData.length}`;
        }

        // Utility function to shuffle an array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Convert CSV to JSON (unchanged)
        function csvToJson(csv) {
            // ... (previous implementation) ...
        }

        // Load the CSV when the page loads
        window.onload = loadCSV;
    </script>
</body>
</html>
