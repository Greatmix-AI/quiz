<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Opmed.ai Knowledge Quiz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .question {
            margin-bottom: 20px;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            transition: opacity 0.5s ease-in-out;
        }
        .options {
            display: flex;
            flex-direction: column;
        }
        .option {
            margin: 5px 0;
        }
        button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
        }
        .correct {
            color: green;
            font-weight: bold;
        }
        .incorrect {
            color: red;
            text-decoration: line-through;
        }
        #progress, #timer {
            margin-bottom: 20px;
        }
        .hidden {
            display: none;
        }
        .fade-out {
            opacity: 0;
        }
        .fade-in {
            opacity: 1;
        }
    </style>
</head>
<body>
    <h1>Opmed.ai Knowledge Quiz</h1>
    <div id="timer"></div>
    <div id="progress"></div>
    <div id="quiz"></div>
    <button id="submitBtn" onclick="submitQuiz()">Submit Quiz</button>
    <button id="nextBtn" onclick="showNextQuestion()" class="hidden">Next Question</button>
    <button id="reviewBtn" onclick="reviewQuiz()" class="hidden">Review Quiz</button>
    <div id="results"></div>

    <script>
        let quizData = [];
        let currentQuestion = 0;
        let userAnswers = [];
        let timerInterval;
        let timeLeft = 600; // 10 minutes

        function loadCSV() {
            fetch('questions.csv')
                .then(response => response.text())
                .then(data => {
                    quizData = csvToJson(data);
                    shuffleArray(quizData);
                    createQuiz();
                    startTimer();
                })
                .catch(error => {
                    console.error('Error loading CSV:', error);
                    document.getElementById('quiz').innerHTML = 'Error loading quiz. Please try again later.';
                });
        }

        function createQuiz() {
            const quizContainer = document.getElementById('quiz');
            quizContainer.innerHTML = '';
            quizData.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question' + (index === 0 ? '' : ' hidden');
                questionDiv.id = `question${index}`;
                
                let options = [
                    {text: question['Option 1'], correct: true},
                    {text: question['Option 2'], correct: false},
                    {text: question['Option 3'], correct: false},
                    {text: question['Option 4'], correct: false}
                ];
                shuffleArray(options);

                questionDiv.innerHTML = `
                    <p><strong>Question ${index + 1}:</strong> ${question.Question}</p>
                    <div class="options">
                        ${options.map((option, i) => `
                            <label class="option">
                                <input type="radio" name="q${index}" value="${i}" data-correct="${option.correct}">
                                ${option.text}
                            </label>
                        `).join('')}
                    </div>
                `;
                quizContainer.appendChild(questionDiv);
            });
            updateProgress();
        }

        function showNextQuestion() {
            if (currentQuestion < quizData.length - 1) {
                document.getElementById(`question${currentQuestion}`).classList.add('fade-out');
                setTimeout(() => {
                    document.getElementById(`question${currentQuestion}`).classList.add('hidden');
                    currentQuestion++;
                    document.getElementById(`question${currentQuestion}`).classList.remove('hidden');
                    setTimeout(() => {
                        document.getElementById(`question${currentQuestion}`).classList.add('fade-in');
                    }, 50);
                    updateProgress();
                }, 500);
            } else {
                document.getElementById('nextBtn').classList.add('hidden');
                document.getElementById('submitBtn').classList.remove('hidden');
            }
        }

        function submitQuiz() {
            clearInterval(timerInterval);
            userAnswers = quizData.map((_, index) => {
                const selected = document.querySelector(`input[name="q${index}"]:checked`);
                return selected ? selected.dataset.correct === 'true' : null;
            });
            displayResults(userAnswers);
            document.getElementById('submitBtn').classList.add('hidden');
            document.getElementById('reviewBtn').classList.remove('hidden');
        }

        function displayResults(results) {
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = '<h2>Quiz Results</h2>';
            let score = 0;
            results.forEach((result, index) => {
                if (result === true) {
                    score++;
                    resultsContainer.innerHTML += `<p>Question ${index + 1}: Correct</p>`;
                } else if (result === null) {
                    resultsContainer.innerHTML += `<p>Question ${index + 1}: Not answered</p>`;
                } else {
                    resultsContainer.innerHTML += `<p>Question ${index + 1}: Incorrect</p>`;
                }
            });
            resultsContainer.innerHTML += `<h3>Total Score: ${score}/${results.length}</h3>`;
        }

        function reviewQuiz() {
            document.getElementById('results').classList.add('hidden');
            document.getElementById('reviewBtn').classList.add('hidden');
            document.getElementById('quiz').classList.remove('hidden');
            quizData.forEach((_, index) => {
                const questionDiv = document.getElementById(`question${index}`);
                questionDiv.classList.remove('hidden');
                const selected = questionDiv.querySelector(`input[name="q${index}"]:checked`);
                if (selected) {
                    selected.parentElement.classList.add(selected.dataset.correct === 'true' ? 'correct' : 'incorrect');
                }
                questionDiv.querySelectorAll('input[type="radio"]').forEach(input => {
                    input.disabled = true;
                });
            });
        }

        function updateProgress() {
            const progress = document.getElementById('progress');
            progress.innerHTML = `Question ${currentQuestion + 1} of ${quizData.length}`;
        }

        function startTimer() {
            const timerDisplay = document.getElementById('timer');
            timerInterval = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerDisplay.innerHTML = `Time left: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz();
                }
                timeLeft--;
            }, 1000);
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function csvToJson(csv) {
            const lines = csv.split('\n');
            const result = [];
            const headers = lines[0].split(',');
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i]) continue;
                const obj = {};
                const currentline = lines[i].split(',');
                for (let j = 0; j < headers.length; j++) {
                    obj[headers[j]] = currentline[j];
                }
                result.push(obj);
            }
            return result;
        }

        window.onload = loadCSV;
    </script>
</body>
</html>
